package parser

import (
	"testing"
)

var brokenBody string = "{"
var exampleBody string = "{\"meta\":{\"version\":1,\"request\":\"http://nba.cloud/league/00/2022/01/27/scoreboard?Format=json\",\"time\":\"2022-05-01T11:34:11.3411Z\"},\"scoreboard\":{\"gameDate\":\"2022-01-27\",\"leagueId\":\"00\",\"leagueName\":\"National Basketball Association\",\"games\":[{\"gameId\":\"0022100733\",\"gameCode\":\"20220127/LALPHI\",\"gameStatus\":3,\"gameStatusText\":\"Final\",\"period\":4,\"gameClock\":\"\",\"gameTimeUTC\":\"2022-01-28T00:30:00Z\",\"gameEt\":\"2022-01-27T19:30:00Z\",\"regulationPeriods\":4,\"seriesGameNumber\":\"\",\"seriesText\":\"\",\"ifNecessary\":false,\"gameLeaders\":{\"homeLeaders\":{\"personId\":203954,\"name\":\"Joel Embiid\",\"playerSlug\":\"joel-embiid\",\"jerseyNum\":\"21\",\"position\":\"C-F\",\"teamTricode\":\"PHI\",\"points\":26,\"rebounds\":9,\"assists\":7},\"awayLeaders\":{\"personId\":203076,\"name\":\"Anthony Davis\",\"playerSlug\":\"anthony-davis\",\"jerseyNum\":\"3\",\"position\":\"F-C\",\"teamTricode\":\"LAL\",\"points\":31,\"rebounds\":12,\"assists\":1}},\"teamLeaders\":{\"homeLeaders\":{\"personId\":203954,\"name\":\"Joel Embiid\",\"playerSlug\":\"joel-embiid\",\"jerseyNum\":\"21\",\"position\":\"C-F\",\"teamTricode\":\"PHI\",\"points\":30.6,\"rebounds\":11.7,\"assists\":4.2},\"awayLeaders\":{\"personId\":201566,\"name\":\"Russell Westbrook\",\"playerSlug\":\"russell-westbrook\",\"jerseyNum\":\"0\",\"position\":\"G\",\"teamTricode\":\"LAL\",\"points\":18.5,\"rebounds\":7.4,\"assists\":7.1},\"seasonLeadersFlag\":0},\"broadcasters\":{\"nationalBroadcasters\":[{\"broadcasterId\":10,\"broadcastDisplay\":\"TNT\"}],\"homeTvBroadcasters\":[],\"homeRadioBroadcasters\":[{\"broadcasterId\":1434,\"broadcastDisplay\":\"WPEN\"}],\"awayTvBroadcasters\":[{\"broadcasterId\":1651,\"broadcastDisplay\":\"SPECSN\"}],\"awayRadioBroadcasters\":[{\"broadcasterId\":1000286,\"broadcastDisplay\":\"KSPN/KWKW-LAL\"}]},\"homeTeam\":{\"teamId\":1610612755,\"teamName\":\"76ers\",\"teamCity\":\"Philadelphia\",\"teamTricode\":\"PHI\",\"teamSlug\":\"sixers\",\"wins\":29,\"losses\":19,\"score\":105,\"seed\":0,\"inBonus\":null,\"timeoutsRemaining\":1,\"periods\":[{\"period\":1,\"periodType\":\"REGULAR\",\"score\":32},{\"period\":2,\"periodType\":\"REGULAR\",\"score\":22},{\"period\":3,\"periodType\":\"REGULAR\",\"score\":34},{\"period\":4,\"periodType\":\"REGULAR\",\"score\":17}]},\"awayTeam\":{\"teamId\":1610612747,\"teamName\":\"Lakers\",\"teamCity\":\"Los Angeles\",\"teamTricode\":\"LAL\",\"teamSlug\":\"lakers\",\"wins\":24,\"losses\":25,\"score\":87,\"seed\":0,\"inBonus\":null,\"timeoutsRemaining\":0,\"periods\":[{\"period\":1,\"periodType\":\"REGULAR\",\"score\":22},{\"period\":2,\"periodType\":\"REGULAR\",\"score\":26},{\"period\":3,\"periodType\":\"REGULAR\",\"score\":20},{\"period\":4,\"periodType\":\"REGULAR\",\"score\":19}]}},{\"gameId\":\"0022100734\",\"gameCode\":\"20220127/MINGSW\",\"gameStatus\":3,\"gameStatusText\":\"Final\",\"period\":4,\"gameClock\":\"\",\"gameTimeUTC\":\"2022-01-28T03:00:00Z\",\"gameEt\":\"2022-01-27T22:00:00Z\",\"regulationPeriods\":4,\"seriesGameNumber\":\"\",\"seriesText\":\"\",\"ifNecessary\":false,\"gameLeaders\":{\"homeLeaders\":{\"personId\":201939,\"name\":\"Stephen Curry\",\"playerSlug\":\"stephen-curry\",\"jerseyNum\":\"30\",\"position\":\"G\",\"teamTricode\":\"GSW\",\"points\":29,\"rebounds\":8,\"assists\":6},\"awayLeaders\":{\"personId\":1626157,\"name\":\"Karl-Anthony Towns\",\"playerSlug\":\"karl-anthony-towns\",\"jerseyNum\":\"32\",\"position\":\"C-F\",\"teamTricode\":\"MIN\",\"points\":31,\"rebounds\":12,\"assists\":6}},\"teamLeaders\":{\"homeLeaders\":{\"personId\":201939,\"name\":\"Stephen Curry\",\"playerSlug\":\"stephen-curry\",\"jerseyNum\":\"30\",\"position\":\"G\",\"teamTricode\":\"GSW\",\"points\":25.5,\"rebounds\":5.2,\"assists\":6.3},\"awayLeaders\":{\"personId\":1626157,\"name\":\"Karl-Anthony Towns\",\"playerSlug\":\"karl-anthony-towns\",\"jerseyNum\":\"32\",\"position\":\"C-F\",\"teamTricode\":\"MIN\",\"points\":24.6,\"rebounds\":9.8,\"assists\":3.6},\"seasonLeadersFlag\":0},\"broadcasters\":{\"nationalBroadcasters\":[{\"broadcasterId\":10,\"broadcastDisplay\":\"TNT\"}],\"homeTvBroadcasters\":[{\"broadcasterId\":1097,\"broadcastDisplay\":\"NBCSBA\"}],\"homeRadioBroadcasters\":[{\"broadcasterId\":1597,\"broadcastDisplay\":\"KGMZ-FM\"}],\"awayTvBroadcasters\":[],\"awayRadioBroadcasters\":[{\"broadcasterId\":1380,\"broadcastDisplay\":\"WCCO\"}]},\"homeTeam\":{\"teamId\":1610612744,\"teamName\":\"Warriors\",\"teamCity\":\"Golden State\",\"teamTricode\":\"GSW\",\"teamSlug\":\"warriors\",\"wins\":36,\"losses\":13,\"score\":124,\"seed\":0,\"inBonus\":null,\"timeoutsRemaining\":0,\"periods\":[{\"period\":1,\"periodType\":\"REGULAR\",\"score\":29},{\"period\":2,\"periodType\":\"REGULAR\",\"score\":28},{\"period\":3,\"periodType\":\"REGULAR\",\"score\":38},{\"period\":4,\"periodType\":\"REGULAR\",\"score\":29}]},\"awayTeam\":{\"teamId\":1610612750,\"teamName\":\"Timberwolves\",\"teamCity\":\"Minnesota\",\"teamTricode\":\"MIN\",\"teamSlug\":\"timberwolves\",\"wins\":24,\"losses\":24,\"score\":115,\"seed\":0,\"inBonus\":null,\"timeoutsRemaining\":1,\"periods\":[{\"period\":1,\"periodType\":\"REGULAR\",\"score\":29},{\"period\":2,\"periodType\":\"REGULAR\",\"score\":32},{\"period\":3,\"periodType\":\"REGULAR\",\"score\":20},{\"period\":4,\"periodType\":\"REGULAR\",\"score\":34}]}}]}}"
var parser Parser

func TestError(t *testing.T) {

	_, err := parser.ParseResults([]byte(brokenBody))
	if err == nil {
		t.Fatalf("Parser should not parse broken JSON string: %v", brokenBody)
	}
}

func TestExampleResult(t *testing.T) {
	results, err := parser.ParseResults([]byte(exampleBody))
	if err != nil || results.Scoreboard.LeagueName != "National Basketball Association" {
		t.Fatalf("Parser failed to parse results body")
	}
}
